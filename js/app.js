var app=function(){function init(){jQuery.ajaxSettings.traditional=!0,getPlaylist({fromYear:1990,toYear:1999,results:64})}function callApi(action,args,options,done,doneFormatting){var defaults={api_key:apiKey},url="http://developer.echonest.com/api/v4/"+action;args=$.extend({},defaults,args),$.getJSON(url,args,function(data){0===data.response.status.code?done(!1,data.response,options,doneFormatting):done(!0)},function(){done(!0)})}function getPlaylist(options,playlist){var args={genre:"hip hop",results:100,bucket:["id:7digital-US","id:deezer","tracks","audio_summary"],type:"genre-radio",adventurousness:.8};callApi("playlist/static",args,options,onPlaylistGet,function(songs){playlist=playlist?playlist.concat(songs):songs,playlist.length<options.results?getPlaylist(options,playlist):(playlist=playlist.slice(0,options.results),cratedigger.loadRecords(playlist)),console.log(playlist.length)})}function onPlaylistGet(error,response,options,doneFormatting){if(!error){var songs=$.map(response.songs,function(song){return formatResponseSong(song,options)});$("#cover").attr("src",songs[0].cover),doneFormatting(songs)}}function formatResponseSong(songData,options){if(tracksData=getDataFromTracks(songData.tracks,options)){var song={title:songData.title,artist:songData.artist_name,cover:tracksData.cover,year:tracksData.year,hasSleeve:!1};return song}return null}function getDataFromTracks(tracks,options){var length=tracks.length,data={cover:null,year:null};if(length){for(var i=0;length>i&&(!data.cover||!data.year);i++)"deezer"==tracks[i].catalog&&!data.year&&tracks[i].album_date?data.year=tracks[i].album_date.substring(0,4):"7digital-US"==tracks[i].catalog&&!data.cover&&tracks[i].release_image&&(data.cover=tracks[i].release_image);return data.cover&&data.year?options&&options.fromYear&&data.year<options.fromYear?null:options&&options.toYear&&data.year>options.toYear?null:data:null}return!1}var apiKey="ASJCKIVQOBWZNXULY";return{init:init}}();$(function(){cratedigger.init({elements:{rootContainerId:"cratedigger",canvasContainerId:"cratedigger-canvas",loadingContainerId:"cratedigger-loading",infosContainerId:"cratedigger-infos",titleContainerId:"cratedigger-record-title",artistContainerId:"cratedigger-record-artist",coverContainerId:"cratedigger-record-cover"}}),app.init()});