var Tastes=function(){function init(userID){$tastesList=$(".tastes-list"),$tasteItemTemplate=$(".tastes-list-item.template"),loadTasteProfile(userID)}function loadTasteProfile(userID){console.log("loading taste profile..."),catalogID?API.readTasteProfile(catalogID,onTasteProfileLoaded):userID&&API.getTasteProfileFromUserID(userID,onTasteProfileLoaded)}function onTasteProfileLoaded(error,catalog){error?console.log("error on getting taste profile"):(console.log("taste profile loaded",catalog),catalogID=catalog.id,tasteItems=catalog.items,$tastesList.empty(),tasteItems.forEach(function(item){createTasteItemElement(item.artist_name,item.song_name)}))}function createTasteItemElement(artist,track){var $newElement=$tasteItemTemplate.clone().removeClass("template");$newElement.find(".tastes-artist").text(artist),$newElement.find(".tastes-track").text(track),$newElement.prependTo($tastesList)}function likeTrack(track,done){catalogID&&API.likeTrack(catalogID,track.id,function(error){error?console.log("error favoriting track",track):(console.log("track added to favs !"),loadTasteProfile(),done())})}function dislikeTrack(track,done){catalogID&&API.dislikeTrack(catalogID,track.id,function(error){error?console.log("error favoriting track",track):(console.log("track added to favs !"),loadTasteProfile(),done())})}function getTrackTasteState(trackID){if(trackID&&tasteItems){console.log("getTrackTasteState",trackID,tasteItems);var track=_.find(tasteItems,{song_id:trackID});return track&&track.rating?track.rating>5?"liked":"disliked":null}}var $tastesList,$tasteItemTemplate,catalogID,tasteItems;return{init:init,likeTrack:likeTrack,dislikeTrack:dislikeTrack,getTrackTasteState:getTrackTasteState}}();